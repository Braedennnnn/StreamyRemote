<script src="https://unpkg.com/peerjs@1.5.4/dist/peerjs.min.js"></script>
<script>



    const urlString = window.location.search; 
    const urlParams = new URLSearchParams(urlString); 


    const paramValue = urlParams.get('id');

    if(paramValue != null && paramValue != ""){
      document.getElementById("peerIdInput").value = paramValue;
    }




    let peer = new Peer();
    let conn;
    let myStream;
		let callstarted = 0;
    let mousecooldown = 0;
    // Show your Peer ID for sharing

    // Function to start sharing the screen


    // Connect and receive a screen stream
    function connectToPeer() {
        const peerId = document.getElementById('peerIdInput').value;
        conn = peer.connect(peerId);

        conn.on('open', function () {
            console.log("connectd");
            
            
            


            if(callstarted == 1){
              conn.send("connected: " + document.getElementById("userName").value)
                document.addEventListener('mousemove', function (event) {
                              var rect = document.getElementById("remoteVideo").getBoundingClientRect();
      x = (event.clientX - rect.left) / document.getElementById("remoteVideo").clientWidth;
      y = (event.clientY - rect.top) / document.getElementById("remoteVideo").clientHeight;

      if(x<0){x=0}
      if(x>1){x=1}
      if(y<0){y=0}
      if(y>1){y=1}
	
  		if(mousecooldown == 0){
      mousecooldown = 1;
			conn.send("mouse: move: " + x + "," + y);	
			setTimeout(function(){
      mousecooldown = 0;
      },50)
      }
      
    	
      })
    
    
                    document.addEventListener('mousedown', function (event) {


                            var rect = document.getElementById("remoteVideo").getBoundingClientRect();
      x = (event.clientX - rect.left) / document.getElementById("remoteVideo").clientWidth;
      y = (event.clientY - rect.top) / document.getElementById("remoteVideo").clientHeight;

      if(x<0){x=0}
      if(x>1){x=1}
      if(y<0){y=0}
      if(y>1){y=1}


      conn.send("mouse: left-down: " + x + "," + y);

    });
    
                        document.addEventListener('mouseup', function (event) {

                            var rect = document.getElementById("remoteVideo").getBoundingClientRect();
      x = (event.clientX - rect.left) / document.getElementById("remoteVideo").clientWidth;
      y = (event.clientY - rect.top) / document.getElementById("remoteVideo").clientHeight;

      if(x<0){x=0}
      if(x>1){x=1}
      if(y<0){y=0}
      if(y>1){y=1}


      conn.send("mouse: left-up: " + x + "," + y);
   
     
    });
    
    
            }
            
        })
    }

    // Handle incoming calls (for screen sharing)
    peer.on('call', function (call) {
        call.answer();  // Answer with the local stream (if available)
    call.on('stream', function (remoteStream) {
        document.getElementById('remoteVideo').srcObject = remoteStream;
        
        
        callstarted = 1;
        
        

    
        
        
        
        
        
        
        
        
    });

    call.on('error', err => {
        console.error('Call error:', err);
    });
    });
</script>

<div>
    <input type="text" id="peerIdInput" placeholder="Enter peer ID to connect">
<input type="text" id="userName" placeholder="Username">
    <button onclick="connectToPeer()">Connect</button>
</div>
<video id="remoteVideo" autoplay width="200"></video>
